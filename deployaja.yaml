name: metabase
version: latest
description: Metabase Analytics Dashboard

container:
  image: ghcr.io/ditasetyakurniawan-droid/metabase:latest
  port: 3000

resources:
  cpu: 2
  memory: 2Gi       # cukup untuk booting dan operasi ringan
  replicas: 1

dependencies:
  - name: postgresql
    type: POSTGRESQL
    version: '15'
    storage_size: 1Gi

env:
  - name: MB_DB_TYPE
    value: postgres
  - name: MB_DB_DBNAME
    value: metabase
  - name: MB_DB_PORT
    value: "5432"
  - name: MB_DB_USER
    value: postgres
  - name: MB_DB_PASS
    value: supersecretpassword
  - name: MB_DB_HOST
    value: chartdb-soto56.apps.svc.cluster.local   # âœ… host PostgreSQL di namespace apps
  - name: MB_SITE_URL
    value: https://metabase.deployaja.id

envMap:
  domain_env: MB_SITE_URL
  db_host_env: MB_DB_HOST
  db_port_env: MB_DB_PORT
  db_name_env: MB_DB_DBNAME
  db_user_env: MB_DB_USER
  db_pass_env: MB_DB_PASS
  db_type_env: MB_DB_TYPE

domain: metabase.deployaja.id
